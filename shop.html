<!-- Renamed to index.html -->
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Book Store</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="modal.css" />
  </head>
  <body class="bg-white text-gray-800">
    <!-- Header -->
    <header class="bg-black text-white p-8">
      <div class="max-w-7xl mx-auto text-center">
        <h1 class="text-4xl font-bold mb-2">BEST BOOKS OF THE YEAR SALE</h1>
        <p class="text-2xl">20% Off</p>
        <p class="text-sm">Top Titles. Best Authors. Limited Time.</p>
        <button class="mt-4 px-4 py-2 bg-white text-black font-semibold rounded hover:bg-gray-200">Shop Now</button>
      </div>
    </header>

    <!-- Main Section -->
    <main class="max-w-7xl mx-auto p-6 grid grid-cols-12 gap-6">
      <!-- Sidebar -->
      <aside class="col-span-3 space-y-6">
        <div class="mb-6">
          <div class="flex items-center mb-4">
            <input id="search-box" type="text" placeholder="Search products..." class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500" />
            <button id="search-btn" class="ml-2 p-2 bg-blue-600 text-white rounded">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-4.35-4.35M17 11a6 6 0 11-12 0 6 6 0 0112 0z" /></svg>
            </button>
          </div>
          <h2 class="text-lg font-semibold mb-2">Product Categories</h2>
          <ul class="space-y-1" id="category-list">
            <!-- Categories will be rendered by JS -->
          </ul>
        </div>

        <div>
          <h2 class="text-lg font-semibold mb-2">Filter by Price</h2>
          <input type="range" min="0" max="100" class="w-full" />
        </div>

        <div>
          <h2 class="text-lg font-semibold mb-2">Average Rating</h2>
          <div class="flex space-x-1 text-yellow-400">
            <span>&#9733;&#9733;&#9733;&#9733;&#9734;</span>
          </div>
        </div>

        <div>
          <h2 class="text-lg font-semibold mb-2">Product Tags</h2>
          <p class="text-sm">Bestseller, New Release, Discount</p>
        </div>
      </aside>

    <!-- Product Grid (JS will render here) -->
      <section class="col-span-9 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4" id="product-grid"></section>

    <!-- Cart Bottom Panel -->
    <div id="cartPanel" class="cart-panel-bottom" style="display:none;position:fixed;left:0;right:0;bottom:0;width:100vw;max-width:100vw;height:auto;min-height:180px;background:#fff;box-shadow:0 -2px 16px rgba(0,0,0,0.10);z-index:3000;padding:24px 18px 18px 18px;transition:bottom 0.3s;">
      <h3 style="margin-top:0;">Your Cart</h3>
      <ul id="inlineCartItems" class="cart-items" style="max-height:30vh;overflow-y:auto;"></ul>
      <p id="inlineCartTotal" class="cart-total">Total: $0.00</p>
      <button onclick="clearCart()" class="clear-cart" style="margin-top:10px;background:#888;color:#fff;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;">Clear All</button>
      <button onclick="toggleCart()" class="close-cart" style="margin-top:10px;background:crimson;color:#fff;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;">Close</button>
    </div>
    <!-- Cart Toggle Button -->
    <button onclick="toggleCart()" class="view-cart-btn" style="position:fixed;top:30px;right:30px;z-index:3100;background:#fff;padding:10px 22px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.08);font-weight:bold;">ðŸ›’ View Cart</button>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-100 text-sm text-center py-6 mt-10 border-t">
      <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between px-4">
        <span>Free Shipping</span>
        <span>Expert Customer Service</span>
        <span>Money Back Guarantee</span>
      </div>
    </footer>
    <script>
      async function fetchProducts() {
        const res = await fetch('products.json');
        return res.json();
      }

      function renderProductCard(product) {
        const defaultColor = product.defaultColor || product.colors[0];
        return `
          <div class="border p-2 sm:p-2 md:p-3 text-center shadow hover:shadow-lg cursor-pointer product-card bg-white rounded-lg flex flex-col relative w-full" style="max-width:240px;min-width:0;" data-id="${product.id}">
            <span class="inline-block bg-red-500 text-white text-xs rounded px-2 py-1 absolute mt-2 ml-2">${product.badge}</span>
            <img src="${product.images[defaultColor]}" alt="${product.title}" class="w-full h-36 sm:h-40 md:h-44 object-cover mb-2 fade-img show rounded-md" data-main-img>
            <h3 class="font-semibold text-sm sm:text-base md:text-lg">${product.title}</h3>
            <p class="text-xs text-gray-600">${product.description}</p>
            <div class="flex justify-center gap-2 my-2">
              ${product.colors.map(c => `<span class="color-dot ${c}" data-color="${c}" style="width:14px;height:14px;border-radius:50%;display:inline-block;border:1px solid #ccc;"></span>`).join('')}
            </div>
            <div class="flex justify-center items-center gap-2">
              <span class="text-blue-600 font-semibold">${product.price}</span>
              <span class="line-through text-gray-400">${product.oldPrice}</span>
            </div>
            <button class="buy-button mt-2 px-3 py-1.5 bg-blue-600 text-white rounded w-full text-xs sm:text-sm" onclick="addToCart('${product.title.replace(/'/g, "\\'")}', ${parseFloat(product.price.replace(/[^\d.]/g, ''))}, '${product.images[defaultColor]}')">Buy Now</button>
          </div>
        `;
      }

      let allProducts = [];
      let currentCategory = "All";
      let currentSearch = "";

      function renderGrid(products) {
        const grid = document.getElementById('product-grid');
        if (grid) {
          grid.innerHTML = products.map(renderProductCard).join('');
          grid.querySelectorAll('.product-card[data-id]').forEach(card => {
            const id = card.getAttribute('data-id');
            const product = products.find(p => p.id === id);
            const img = card.querySelector('[data-main-img]');
            card.querySelectorAll('.color-dot[data-color]').forEach(dot => {
              dot.addEventListener('click', function(e) {
                e.stopPropagation();
                const color = dot.getAttribute('data-color');
                if (product.images[color]) {
                  img.classList.remove('show');
                  setTimeout(() => {
                    img.src = product.images[color];
                    img.classList.add('show');
                  }, 200);
                }
              });
            });
            card.addEventListener('click', function(e) {
              if (e.target.closest('button') || e.target.classList.contains('color-dot')) return;
              if (!product) return;
              const modal = createModal(product);
              document.body.appendChild(modal);
            });
          });
        }
      }

      function getFilteredProducts() {
        let filtered = allProducts;
        if (currentCategory !== "All") {
          filtered = filtered.filter(p => p.category === currentCategory);
        }
        if (currentSearch.trim()) {
          const q = currentSearch.trim().toLowerCase();
          filtered = filtered.filter(p =>
            p.title.toLowerCase().includes(q) ||
            p.description.toLowerCase().includes(q)
          );
        }
        return filtered;
      }

      function renderCategories(products) {
        const categoryList = document.getElementById('category-list');
        if (!categoryList) return;
        const categories = Array.from(new Set(products.map(p => p.category).filter(Boolean)));
        const allCats = ["All", ...categories];
        categoryList.innerHTML = allCats.map(cat => `<li class="cursor-pointer hover:underline${cat === "All" ? ' font-bold text-blue-600' : ''}" data-category="${cat}">${cat}</li>`).join('');
      }

      fetchProducts().then(products => {
        allProducts = products;
        renderCategories(allProducts);
        renderGrid(getFilteredProducts());
        // Add category click handler
        const categoryList = document.getElementById('category-list');
        if (categoryList) {
          categoryList.addEventListener('click', function(e) {
            const li = e.target.closest('li[data-category]');
            if (!li) return;
            currentCategory = li.getAttribute('data-category');
            document.querySelectorAll('#category-list li').forEach(el => el.classList.remove('font-bold', 'text-blue-600'));
            li.classList.add('font-bold', 'text-blue-600');
            renderGrid(getFilteredProducts());
          });
        }
        // Search box logic
        const searchBox = document.getElementById('search-box');
        const searchBtn = document.getElementById('search-btn');
        if (searchBox) {
          searchBox.addEventListener('input', function() {
            currentSearch = searchBox.value;
            renderGrid(getFilteredProducts());
          });
        }
        if (searchBtn) {
          searchBtn.addEventListener('click', function() {
            currentSearch = searchBox.value;
            renderGrid(getFilteredProducts());
          });
        }
      });

      function addToCart(name, price, image) {
        const cartItem = { name, price, image };
        let cart = JSON.parse(localStorage.getItem("cart")) || [];
        cart.push(cartItem);
        localStorage.setItem("cart", JSON.stringify(cart));
        renderInlineCart();
        openCart();
      }

      function toggleCart() {
        document.getElementById("cartPanel").classList.toggle("active");
        renderInlineCart();
      }

      function openCart() {
        document.getElementById("cartPanel").classList.add("active");
        renderInlineCart();
      }

      function renderInlineCart() {
        const cart = JSON.parse(localStorage.getItem("cart")) || [];
        const cartItemsEl = document.getElementById("inlineCartItems");
        const cartTotalEl = document.getElementById("inlineCartTotal");
        cartItemsEl.innerHTML = "";
        let total = 0;
        if (cart.length === 0) {
          cartItemsEl.innerHTML = "<li>Your cart is empty.</li>";
          cartTotalEl.textContent = "Total: $0.00";
          return;
        }
        cart.forEach((item, i) => {
          const li = document.createElement("li");
          li.className = "cart-item";
          li.innerHTML = `<img src="${item.image}" style="width:50px;height:50px;border-radius:6px;object-fit:cover;margin-right:10px;">${item.name} <span style="margin-left:auto;font-weight:bold;">$${item.price}</span> <button onclick="removeCartItem(${i})" style="background:crimson;color:#fff;border:none;padding:2px 8px;border-radius:4px;cursor:pointer;">x</button>`;
          cartItemsEl.appendChild(li);
          total += Number(item.price);
        });
        cartTotalEl.textContent = `Total: $${total.toFixed(2)}`;
      }

      function removeCartItem(idx) {
        let cart = JSON.parse(localStorage.getItem("cart")) || [];
        cart.splice(idx, 1);
        localStorage.setItem("cart", JSON.stringify(cart));
        renderInlineCart();
      }

      function clearCart() {
        localStorage.setItem("cart", JSON.stringify([]));
        renderInlineCart();
      }

      function createModal(product) {
        const modalBg = document.createElement('div');
        modalBg.className = 'modal-bg';
        const defaultColor = product.defaultColor || product.colors[0];
        modalBg.innerHTML = `
          <div class="modal-card">
            <span class="modal-close" title="Close">&times;</span>
            <img src="${product.images[defaultColor]}" alt="${product.title}" style="width:100%;border-radius:12px;object-fit:cover;max-height:220px;box-shadow:0 4px 16px rgba(0,0,0,0.10);margin-bottom:12px;" class="fade-img show" data-modal-img>
            <span class="badge" style="position:absolute;top:20px;left:20px;">${product.badge}</span>
            <h3 class="product-title" style="margin-top:18px;font-size:1.3rem;font-weight:600;">${product.title}</h3>
            <p class="description" style="margin-bottom:10px;color:#555;font-size:1rem;">${product.description}</p>
            <div class="price-row" style="margin-bottom:10px;display:flex;align-items:center;gap:10px;">
              <span class="new-price" style="color:#2563eb;font-weight:bold;">${product.price}</span>
              <span class="old-price" style="text-decoration:line-through;color:#888;font-size:14px;">${product.oldPrice}</span>
            </div>
            <div class="colors" style="margin-bottom:10px;display:flex;gap:8px;justify-content:center;">
              ${product.colors.map(c => `<span class="color-dot ${c}" data-color="${c}" style="width:18px;height:18px;border-radius:50%;border:2px solid #eee;box-shadow:0 2px 6px rgba(0,0,0,0.07);"></span>`).join('')}
            </div>
            <div class="promo" style="margin-bottom:10px;display:flex;justify-content:space-between;align-items:center;">
              <span class="promo-code" style="background:#f3f3f3;padding:2px 8px;border-radius:4px;font-weight:bold;">${product.promoCode}</span>
              <span class="promo-discount" style="color:purple;font-weight:bold;">${product.promoDiscount}</span>
            </div>
            <button class="buy-button" style="margin-top:10px;width:100%;background:#2563eb;color:#fff;padding:10px 0;border-radius:8px;font-weight:600;font-size:1rem;">BUY +</button>
          </div>
        `;
        // Color switching for modal image
        const modalImg = modalBg.querySelector('[data-modal-img]');
        modalBg.querySelectorAll('.color-dot[data-color]').forEach(dot => {
          dot.addEventListener('click', function(e) {
            e.stopPropagation();
            const color = dot.getAttribute('data-color');
            if (product.images[color]) {
              modalImg.classList.remove('show');
              setTimeout(() => {
                modalImg.src = product.images[color];
                modalImg.classList.add('show');
              }, 200);
            }
          });
        });
        modalBg.querySelector('.modal-close').onclick = () => modalBg.remove();
        modalBg.onclick = e => { if (e.target === modalBg) modalBg.remove(); };
        return modalBg;
      }
    </script>
  </body>
</html>
